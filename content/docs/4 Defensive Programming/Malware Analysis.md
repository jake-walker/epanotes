---
title: "Malware Analysis"
---

## Analysis Methods

- Static - methods not involving the running of the malware
	- **AV Scanning** - gives a quick indication as to whether something is malicious
	- **Fingerprinting** - checking against other online sources (e.g. [VirusTotal](https://virustotal.com))
	- **Strings** - find domains, IP addresses, function names and can be used to give small clues to the function of malware
	- **Packing/Obfuscation** - knowing tools used to pack or obfuscate can help in unpacking & executing and knowing the language or tooling that is used
	- **PE File Format** - finding sections in the executable to be reversed
	- **Libraries & Functions** - good indication of what the malware is doing
	- **Reverse Engineering & [Assembly]({{< ref "docs/4 Defensive Programming/Assembly" >}})** - (e.g. [GDB]({{< ref "docs/4 Defensive Programming/Assembly#gdb-reference" >}}))
- Dynamic - methods involving running and observing events
	- **Run Malware & Monitor Activity** - useful to confirm whether it is performing as expected from static analysis
	- **Processes** - what processes are created?
	- **System Calls**
	- **Registry Keys**
	- **Network Activity**
	- **Debugging**

## Library types

- **Static** - whole code copied and included with program
- **Runtime** - program interacts with libraries only when needed
- **Dynamic** - program imports referenced libraries as program starts.

## PE File Format

| Name | Description |
| --- | --- |
| DOS MZ Header | |
| DOS Stub | |
| PE Header | Metadata - signature, number of sections, executable or DLL, timestamp, machine |
| .text | Executable code to be copied to RAM |
| .idata | Imported data |
| .data | Data loaded to initialise - static & global variables |
| .rdata | Runtime data during execution |
| .edata | Export information |
| .rsrc | Resources used by executable (e.g. files) |
| .reloc | |

## Memory

| Name | Description |
| --- | --- |
| Data | Values |
| Code | Instructions to be fetched by the CPU |
| Heap | Dynamically allocated variables |
| Stack | Function parameters, controls program flow |

## Tools
- [malwr.com](https://malwr.com), [VirusTotal](https://virustotal.com)
- strings
- md5sum, sha1sum, sha1deep, WinMD5, etc...
- [PEiD](https://www.aldeid.com/wiki/PEiD) - detect packed files
- [PEView](http://wjradburn.com/software/) - examine PE files
- [PE Browse](https://download.cnet.com/PEBrowse-Professional-64-bit/3000-2218_4-75176627.html) / [PE Explorer](http://www.pe-explorer.com/) - browse PE headers
- [ImpREC](https://forum.tuts4you.com/files/file/2367-import-reconstructor-imprec/) - rebuild import table
- [LordPE](https://www.softpedia.com/get/Programming/File-Editors/LordPE.shtml) - dump executable from memory
- [Dependency Walker](https://www.dependencywalker.com/) - explore DLLs and imported functions
- [Process Explorer](https://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer)
- [Process Monitor (procmon)](https://learn.microsoft.com/en-us/sysinternals/downloads/procmon)
- [RegShot](https://sourceforge.net/projects/regshot/)
- [rundll32.exe](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/rundll32)
- [WireShark](https://www.wireshark.org/)
- [tcpdump](https://www.tcpdump.org/)
- [Apate DNS](https://fireeye.market/apps/211380)
- netcat
- [Volatility Framework](https://www.volatilityfoundation.org/)
- [OllyDbg](https://www.ollydbg.de/)
- [IDA Pro](https://hex-rays.com/ida-pro/)
- [WinDBG](https://windbg.org/)
- GDB ([reference]({{< ref "docs/4 Defensive Programming/Assembly#gdb-reference" >}}))
- [Ghidra](https://ghidra-sre.org/)
- [Joe Sandbox](https://www.joesandbox.com/)